{% extends "::layout.html.twig" %}

{% block title %}
	{{ parent() }} - Home
{% endblock %}

{% block body %}
	{{ parent() }}

	{# Process mark averages #}
	{% set globalAvg	= 0		%}
	{% set platformsAvg = []	%}
	{% set nbAvg		= 0		%}

	<div class="row">
		<div class="col-md-12">
			<h1><a href=" {{ path('g2s_app_show_app_one', {'app_id': app.id}) }}">{{ app.name }}</a></h1>
			<hr/>
		</div>
		<div class="col-md-9">
			{% for tag in app.tags %}
				<a href="{{ path('g2s_app_show_tag', {'tag_id': tag.id}) }}" class="label label-primary">{{ tag.name }}</a>
			{% endfor %}
			<p>{{ app.description }}</p>
		</div>

		<div class="col-md-3">
			<div class="row">
				<div class="panel panel-primary">
					<div class="panel-heading">
						<h4>Download For :</h4>
					</div>
					<div class="panel-body">
						{% if app.appInfos|length == 1 %}
							{% set width	= 12 %}
						{% elseif app.appInfos|length == 2 %}
							{% set width	= 6 %}
						{% else %}
							{% set width	= 4 %}
						{% endif %}
						{% for appInfo in app.appInfos %}
							<div class="col-sm-{{ width }}">
								<a href='{{appInfo.downloadPath}}'>
									<img src="/web/web/img/{{appInfo.platform.logoPath}}" alt="{{ appInfo.platform.name }}" height="64" width="64"/>
									<br/>
									{{ appInfo.platform.name }}
								</a>
							</div>

							{# Process mark averages #}
							{% set avg		= 0 %}
							{% set markIt	= 0 %}

							{% for mark in appInfo.marks %}
								{% set avg		= avg + mark.mark %}
								{% set markIt	= markIt + 1 %}
							{% endfor %}

							{% if markIt > 0 %}
								{% set avg			= avg / markIt %}
								{% set globalAvg	= globalAvg + avg %}
								{% set nbAvg		= nbAvg + 1 %}
							{% else %}
								{% set avg = -1 %}
							{% endif %}

							{% set platformsAvg = platformsAvg | merge([avg]) %}

						{% else %}
							<p>Aucune plateforme support√©e</p>
						{% endfor %}

						{# Process mark averages #}
						{% if nbAvg > 0 %}
							{% set globalAvg = globalAvg / nbAvg %}
						{% endif %}
					</div>
					<div class="panel-heading">
						<h4>Marks : {{ globalAvg }} / 20</h4>
					</div>
					<div class="panel-body">
						<ul>
						{% set platformIt = 0 %}
						{% for appInfo in app.appInfos %}
							<li>
								{{ appInfo.platform.name }} :
								{% if platformsAvg[platformIt] != -1 %}
									{{ platformsAvg[platformIt] }}
								{% else %}
									-
								{% endif %}
								/ 20
							</li>
							{% set platformIt = platformIt + 1 %}
						{% endfor %}
						</ul>
					</div>
				</div>
			</div>
		</div>

		<div class="col-md-12">
			<h2>Comments <a href="{{ path('g2s_app_add_comment', {'app_id': app.id}) }}" type="button" class="btn btn-primary"><span class="glyphicon glyphicon-plus-sign"></span> Add</a> </h2>
			{% for appInfo in app.appInfos %}
				{% for comment in appInfo.comments %}
					<div class="panel panel-info">
						<div class="panel-heading">
							<strong>{{ comment.title }}</strong>
							{% if comment.mark is not null%}
								{{ comment.mark.mark }} / 20
							{% endif %}
							<em>({{ appInfo.platform.name }})</em>
						</div>
						<div class="panel-body">
							{{ comment.comment }}
						</div>
					</div>
				{% endfor %}
			{% endfor %}
		</div>
	</div>

	<hr/>

{% endblock %}
